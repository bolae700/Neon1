<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>♪ Pola's Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
      :root {
        --bg-grad-1: #0000FF; /* Pure Electric Blue */
        --bg-grad-2: #00B4FF; /* Vibrant Cyan Blue */
        --accent-active: #00B4FF; /* Vibrant Cyan Blue */
        --accent-hover: #87E0FF; /* Light Cyan */
        --ui-bg: #FFFFFF;
        --text-dark: #011627; /* Deep Navy */
        --font-title: 'Fredoka One', cursive;
        --font-body: 'Nunito', sans-serif;
      }

      /* Base and Reset */
      html, body {
        height: 100%;
        width: 100%;
        overflow: hidden;
        overscroll-behavior: none;
        margin: 0;
        padding: 0;
        font-family: var(--font-body);
        background-color: var(--bg-grad-1);
        -webkit-tap-highlight-color: transparent;
      }

      /* Main Layout - Using Flexbox for perfect centering */
      .app-container {
        height: 100vh;
        width: 100vw;
        background: linear-gradient(200deg, var(--bg-grad-1), var(--bg-grad-2));
        background-size: 200% 200%;
        animation: background-pan 15s ease infinite;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        padding: 16px;
        box-sizing: border-box;
      }
      
      .main-content-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 25px;
        z-index: 10;
        width: 100%;
        max-width: 400px;
        opacity: 0;
        transform: translateY(30px);
        animation: fade-in-up 0.8s 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      }

      /* Animated Background Shapes */
      .floating-shapes {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 0;
      }

      .shape {
        position: absolute;
        bottom: -150px;
        color: rgba(255, 255, 255, 0.1);
        animation-name: float;
        animation-timing-function: linear;
        animation-iteration-count: infinite;
        will-change: transform;
      }
      .shape svg {
        filter: drop-shadow(0 0 10px rgba(135, 224, 255, 0.4));
      }

      /* Refined Pop / Glow Style */
      .pop-element {
        background: var(--ui-bg);
        border: 2px solid var(--text-dark);
        box-shadow: 0 0 15px rgba(0, 180, 255, 0.4), 
                    inset 0px 2px 1px rgba(255, 255, 255, 1);
        transition: box-shadow 0.3s ease, transform 0.3s ease;
      }

      /* Content Window */
      .content-window-container {
        width: 100%;
        height: clamp(400px, 65vh, 400px);
        position: relative;
      }

      .content-window {
        width: 100%;
        height: 100%;
        border-radius: 25px;
        position: absolute;
        will-change: transform, opacity;
        padding: 20px;
        box-sizing: border-box;
      }
      
      .content-window.entering {
        animation: pop-in-wobble 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }
      
      .content-window.exiting {
        animation: shrink-out 0.4s cubic-bezier(0.55, 0.06, 0.68, 0.19) forwards;
      }
      
      /* Navigation Dock */
      .dock {
        border-radius: 9999px;
        padding: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        position: relative;
        width: fit-content;
      }
      
      .dock-item {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        background: none;
        cursor: pointer;
        transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), color 0.2s ease;
        color: var(--text-dark);
        opacity: 0.5;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .dock-item:hover { 
        opacity: 1; 
        transform: scale(1.2); 
        color: var(--accent-active);
      }
      .dock-item.active { 
        opacity: 1; 
        transform: scale(1.1); 
        color: var(--accent-hover); /* Active icon is light blue on cyan pill */
      }
      .dock-item:active { transform: scale(0.9) !important; transition: transform 0.1s ease; }
      .dock-item svg { width: 30px; height: 30px; }
      
      .active-pill {
        position: absolute;
        top: 10px;
        left: 10px;
        width: 50px;
        height: 50px;
        background: var(--accent-active);
        border-radius: 50%;
        z-index: -1;
        transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1);
      }

      /* Home Window Styles - PERFECTED Spacing */
      .home-content { display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: var(--text-dark); height: 100%; box-sizing: border-box; gap: clamp(8px, 2.2vh, 15px); padding: 10px 0; }
      .home-content img { width: clamp(90px, 24vw, 110px); height: clamp(90px, 24vw, 110px); border-radius: 50%; border: 4px solid var(--text-dark); object-fit: cover; transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); cursor: pointer; margin: 0; }
      .home-content img:hover { transform: scale(1.1) rotate(-5deg); border-color: var(--accent-active); box-shadow: 5px 5px 0px var(--accent-active); }
      .home-content h1 { font-family: var(--font-title); font-size: clamp(1.8rem, 7vw, 2.2rem); margin: 0; }
      .home-content .quote { font-size: clamp(0.7rem, 2vw, 0.75rem); max-width: 300px; margin: 0; opacity: 0.7; line-height: 1.5; }
      .home-content .status { font-size: clamp(1rem, 4vw, 1.1rem); font-weight: 700; display: flex; align-items: center; gap: 8px; margin: 0; }
      .home-content .status span { color: var(--accent-active); animation: heart-thump 1.2s ease-in-out infinite; }
      .home-content .socials { display: flex; gap: 20px; margin-top: 5px; }
      .home-content .socials a { color: var(--text-dark); opacity: 0.6; transition: all 0.3s; }
      .home-content .socials a:hover { opacity: 1; color: var(--accent-active); animation: jiggle 0.5s; }
      .home-content .socials svg { width: 28px; height: 28px; }
      
      /* Gallery Window Styles */
      .gallery-content { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; height: 100%; box-sizing: border-box; }
      .gallery-item { border-radius: 20px; position: relative; overflow: hidden; border: 3px solid var(--text-dark); transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); cursor: pointer; }
      .gallery-item:hover { transform: translateY(-8px) scale(1.05) rotate(3deg); box-shadow: 8px 8px 0px var(--accent-active); border-color: var(--accent-active); }
      .gallery-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
      .gallery-item::after { content: ''; position: absolute; top: -50%; left: -60%; width: 20%; height: 200%; background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%); transform: rotate(25deg); transition: left 0.8s cubic-bezier(0.23, 1, 0.32, 1); }
      .gallery-item:hover::after { left: 140%; }


      /* Clock Window Styles - AM/PM Fixed */
      .clock-content { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; width: 100%; color: var(--text-dark); font-family: var(--font-title); }
      #time-display { font-size: clamp(3rem, 15vw, 4rem); letter-spacing: 0.1em; display: flex; align-items: baseline; }
      #time-ampm { font-size: 0.4em; margin-left: 8px; font-weight: 700; color: var(--text-dark); background: none; -webkit-background-clip: initial; background-clip: initial; opacity: 0.6; }
      #date-display { font-size: clamp(0.9rem, 4vw, 1rem); opacity: 0.7; margin-top: 8px; font-family: var(--font-body); font-weight: 700; }

      /* Music Player Styles - Optimized */
      .music-player { display: flex; flex-direction: column; color: var(--text-dark); box-sizing: border-box; height: 100%; }
      .music-player .track-info { flex-shrink: 0; text-align: center; margin-bottom: 12px; }
      .music-player .track-info h2 { font-size: 1.25rem; font-weight: 900; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin: 0;}
      .music-player .track-info p { font-size: 0.875rem; opacity: 0.8; margin: 4px 0 0; }
      .music-player .progress-bar-container { width: 100%; height: 10px; background: rgba(0,0,0,0.1); border-radius: 5px; cursor: pointer; }
      .music-player .progress-bar { height: 100%; background: var(--accent-active); border-radius: 5px; }
      .music-player .controls { display: flex; justify-content: center; align-items: center; gap: 15px; margin: 12px 0; }
      .music-player .control-btn { border-radius: 50%; border: 3px solid var(--text-dark); background: var(--ui-bg); color: var(--text-dark); opacity: 0.8; cursor: pointer; transition: all 0.2s ease; display:flex; justify-content:center; align-items:center; }
      .music-player .control-btn:hover { opacity: 1; transform: scale(1.1) translateY(-2px); color: var(--accent-active); border-color: var(--accent-active); }
      .music-player .control-btn:active { transform: scale(0.95); transition-duration: 0.1s; }
      .music-player .play-pause-btn { width: 65px; height: 65px; }
      .music-player .prev-next-btn { width: 50px; height: 50px; }
      .music-player .tracklist { flex-grow: 1; overflow-y: auto; padding-right: 8px; }
      .music-player .tracklist ul { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px; }
      .music-player .tracklist li { padding: 8px 12px; border-radius: 12px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
      .music-player .tracklist li.active { background-color: var(--accent-active); color: var(--text-dark); border-color: var(--text-dark); }
      .music-player .tracklist li:not(.active):hover { background-color: rgba(0, 180, 255, 0.4); }
      .music-player .tracklist li.active.flash { animation: flash-in 0.4s ease; }
      .music-player .tracklist p { margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .music-player .tracklist .title { font-weight: 700; }
      .music-player .tracklist .artist { font-size: 0.75rem; opacity: 0.7; }
      .scrollbar-custom::-webkit-scrollbar { width: 8px; }
      .scrollbar-custom::-webkit-scrollbar-track { background: transparent; }
      .scrollbar-custom::-webkit-scrollbar-thumb { background-color: var(--accent-active); border-radius: 10px; border: 2px solid var(--ui-bg); }

      /* Premium Visuals */
      .gradient-text {
        background: linear-gradient(45deg, var(--accent-active), var(--accent-hover));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }
      
      /* Accessibility */
      :is(button, a, .gallery-item, .tracklist li):focus-visible {
        outline: 3px solid var(--accent-active);
        outline-offset: 3px;
        border-radius: 8px;
        box-shadow: 0 0 0 4px var(--ui-bg);
      }

      /* Keyframe Animations */
      @keyframes background-pan { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
      @keyframes float { from { transform: translateY(0px) rotate(0deg); opacity: 1; } to { transform: translateY(-110vh) rotate(360deg); opacity: 0; } }
      @keyframes heart-thump { 0%, 100% { transform: scale(1); } 10%, 30% { transform: scale(0.9); } 20% { transform: scale(1.2); } }
      @keyframes pop-in-wobble { 0% { opacity: 0; transform: scale(0.5) rotate(-15deg); } 70% { opacity: 1; transform: scale(1.1) rotate(5deg); } 100% { opacity: 1; transform: scale(1) rotate(0deg); } }
      @keyframes shrink-out { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.5); } }
      @keyframes fade-in-up { to { opacity: 1; transform: translateY(0); } }
      @keyframes flash-in { 0% { transform: scale(0.95); background-color: color-mix(in srgb, var(--accent-active) 50%, #fff); } 50% { transform: scale(1.05); } 100% { transform: scale(1); background-color: var(--accent-active); } }
      @keyframes jiggle { 0%, 100% { transform: rotate(0) scale(1.1); } 25% { transform: rotate(-5deg) scale(1.1); } 50% { transform: rotate(5deg) scale(1.1); } 75% { transform: rotate(-2deg) scale(1.1); } }
      
      /* Responsive Design */
      @media (max-width: 480px) {
        .dock { padding: 8px; gap: 5px; }
        .dock-item, .active-pill { width: 44px; height: 44px; }
        .active-pill { top: 8px; left: 8px; }
        .dock-item svg { width: 26px; height: 26px; }
        .main-content-wrapper { gap: 15px; }
      }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        
        <div class="floating-shapes"></div>

        <div class="main-content-wrapper">
          <div id="content-window-container" class="content-window-container"></div>
          
          <nav id="dock" class="dock pop-element">
              <div id="active-pill" class="active-pill"></div>
              <button class="dock-item" data-tab="home" aria-label="home">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></svg>
              </button>
              <button class="dock-item" data-tab="music" aria-label="music">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13" /><circle cx="6" cy="18" r="3" /><circle cx="18" cy="16" r="3" /></svg>
              </button>
              <button class="dock-item" data-tab="gallery" aria-label="gallery">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2" /><circle cx="9" cy="9" r="2" /><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" /></svg>
              </button>
              <button class="dock-item" data-tab="clock" aria-label="clock">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></svg>
              </button>
          </nav>
        </div>
        
        <audio id="audio-player"></audio>
    </div>

    <!-- TEMPLATES -->
    <template id="home-template">
        <div class="home-content">
            <img src="https://i.ibb.co/dPFpGv9/Default-Cute-anime-boy-pray-3d-art-cartoon-blue-1-30826f36-54b1-49e4-b141-5caad93c4a2c-0.jpg" alt="Profile" />
            <h1><span class="gradient-text">♪ Pola</span></h1>
            <p class="quote">"But those who hope in the LORD will renew their strength. They will soar on wings like eagles; they will run and not grow weary, they will walk and not be faint." (Isaiah 40:31)</p>
            <p class="status"><span>❤</span> GOD IS LOVE <span>❤</span></p>
            <div class="socials">
                <a href="https://github.com/bolae700" target="_blank" rel="noopener noreferrer" aria-label="Github Profile"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
                <a href="https://www.youtube.com/@SoundSurge3" target="_blank" rel="noopener noreferrer" aria-label="YouTube Channel"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 17a24.12 24.12 0 0 1 0-10C2.5 6 7.5 4 12 4s9.5 2 9.5 3a24.12 24.12 0 0 1 0 10c0 1-5 3-9.5 3s-9.5-2-9.5-3Z"></path><path d="m10 15 5-3-5-3z"></path></svg></a>
            </div>
        </div>
    </template>
    <template id="gallery-template">
        <div class="gallery-content">
            <div class="gallery-item" tabindex="0"><img src="https://i.ibb.co/pXfwCcv/2d79b46de2deb3744fd330d815b76751.jpg" alt="gallery image 1" /></div>
            <div class="gallery-item" tabindex="0"><img src="https://i.ibb.co/Jyq80hX/bfa64e7da2612eb344663aa3fbcf2f59.png" alt="gallery image 2" /></div>
            <div class="gallery-item" tabindex="0"><img src="https://i.ibb.co/dDVSRPD/ss.png" alt="gallery image 3" /></div>
            <div class="gallery-item" tabindex="0"><img src="https://xatimg.com/image/rWDHtSw2pqG2.jpg" alt="gallery image 4" /></div>
        </div>
    </template>
    <template id="clock-template">
        <div class="clock-content">
            <div id="time-display" class="gradient-text">
                <span id="time-value"></span><span id="time-ampm"></span>
            </div>
            <div id="date-display"></div>
        </div>
    </template>
    <template id="music-template">
        <div class="music-player">
            <div class="track-info">
                <h2 id="track-title"></h2>
                <p id="track-artist"></p>
            </div>
            <div id="progress-container" class="progress-bar-container">
                <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
            </div>
            <div class="controls">
                <button id="prev-btn" class="control-btn prev-next-btn" aria-label="Previous Song"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 19 2 12 11 5 11 19"></polygon><polygon points="22 19 13 12 22 5 22 19"></polygon></svg></button>
                <button id="play-pause-btn" class="control-btn play-pause-btn" aria-label="Play"></button>
                <button id="next-btn" class="control-btn prev-next-btn" aria-label="Next Song"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 19 22 12 13 5 13 19"></polygon><polygon points="2 19 11 12 2 5 2 19"></polygon></svg></button>
            </div>
            <div class="tracklist scrollbar-custom">
                <ul id="track-list-ul"></ul>
            </div>
        </div>
    </template>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // --- STATE ---
        let activeTab = 'home';
        let clockInterval = null;
        let audioContext = null;

        const tracks = [
            { url: "https://audio.jukehost.co.uk/QyPglgdEHAkfqpR1NH5rMHiewfPCSg4o", title: "Ahlef be allah", artist: "Haitham Shaker" },
            { url: "https://audio.jukehost.co.uk/GkbwKXyHWfNGWHtJWsdemKmpOFJFkdCK", title: "Alors on dance", artist: "Stromae" },
            { url: "https://audio.jukehost.co.uk/MHf54iEPyQIkSmY55VYlqHGSH7CVQqdA", title: "Casablanca", artist: "Emre Kabak" },
            { url: "https://audio.jukehost.co.uk/GOzONzgMkJgOFZgbzmCAPU3uXpKKcYAh", title: "Unstoppable", artist: "Sia" },
            { url: "https://audio.jukehost.co.uk/c77yqDnvZV6lAmIPQPanmSgqVpnlnDyv", title: "Saber W Radi", artist: "George Wassouf" },
            { url: "https://audio.jukehost.co.uk/6tOF41jBlb83ocuYrxtuW7sAmEgyRyFZ", title: "Shoukran", artist: "George Wassouf" },
            { url: "https://audio.jukehost.co.uk/bbabQwnKnYhXlaRD8alUDCzGEhyu9Rwm", title: "Khadny 7aneen", artist: "George Wassouf" },
            { url: "https://audio.jukehost.co.uk/lrUXO0jmrJRZANKo0Gx9XEQ0PFuQxKN5", title: "Yalli Bitghib Aleiya", artist: "Haitham Shaker" },
            { url: "https://audio.jukehost.co.uk/6IQhCPy39Jv5Uxj9WI4fFMeUuJMWWR2D", title: "Khalik Ganbi", artist: "Haitham Shaker" },
        ];
        let currentTrackIndex = 0;
        let isPlaying = false;
        
        // --- DOM ELEMENTS ---
        const contentContainer = document.getElementById('content-window-container');
        const dock = document.getElementById('dock');
        const dockItems = document.querySelectorAll('.dock-item');
        const activePill = document.getElementById('active-pill');
        const floatingShapesContainer = document.querySelector('.floating-shapes');
        const audioPlayer = document.getElementById('audio-player');

        // --- ICONS ---
        const playIcon = `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>`;
        const pauseIcon = `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>`;

        // --- SOUND ENGINE ---
        const initAudioContext = () => {
            if (audioContext) return;
            try { audioContext = new (window.AudioContext || window.webkitAudioContext)(); } 
            catch(e) { console.warn("Web Audio API is not supported in this browser"); }
        };
        const playSound = (type) => {
            if (!audioContext || audioContext.state === 'suspended') return;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            const now = audioContext.currentTime;
            if (type === 'click') { oscillator.type = 'triangle'; gainNode.gain.setValueAtTime(0.3, now); oscillator.frequency.setValueAtTime(440, now); gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1); oscillator.frequency.exponentialRampToValueAtTime(220, now + 0.1); } 
            else if (type === 'hover') { oscillator.type = 'sine'; gainNode.gain.setValueAtTime(0.05, now); oscillator.frequency.setValueAtTime(800, now); gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1); } 
            else if (type === 'plop') { oscillator.type = 'sine'; gainNode.gain.setValueAtTime(0.6, now); oscillator.frequency.setValueAtTime(120, now); gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.2); oscillator.frequency.exponentialRampToValueAtTime(60, now + 0.2); } 
            else if (type === 'note') { oscillator.type = 'sine'; gainNode.gain.setValueAtTime(0.2, now); oscillator.frequency.setValueAtTime(392, now); gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.15); }
            oscillator.start(now);
            oscillator.stop(now + 0.2);
        };
        
        // --- UI & TABS ---
        const updatePillPosition = (activeButton) => {
            const offset = activeButton.offsetLeft;
            activePill.style.transform = `translateX(${offset}px)`;
        };
        const switchTab = (tabId) => {
            if (activeTab === tabId && contentContainer.hasChildNodes()) return;
            playSound('plop');
            if (clockInterval) { clearInterval(clockInterval); clockInterval = null; }
            activeTab = tabId;
            const oldContent = contentContainer.querySelector('.content-window');
            if(oldContent) {
                oldContent.classList.remove('entering');
                oldContent.classList.add('exiting');
                oldContent.addEventListener('animationend', () => oldContent.remove(), { once: true });
            }
            const template = document.getElementById(`${tabId}-template`);
            const newContent = document.createElement('div');
            newContent.classList.add('content-window', 'pop-element', 'entering');
            newContent.innerHTML = template.innerHTML;
            setTimeout(() => {
                 contentContainer.appendChild(newContent);
                 if (tabId === 'clock') initClock(newContent);
                 if (tabId === 'music') initMusicPlayerUI(newContent);
            }, oldContent ? 150 : 0);
            dockItems.forEach(item => {
                item.classList.toggle('active', item.dataset.tab === tabId);
            });
            updatePillPosition(dock.querySelector(`[data-tab="${tabId}"]`));
        };

        // --- TAB-SPECIFIC LOGIC ---
        function initClock(contentElement) {
            const timeValueEl = contentElement.querySelector('#time-value');
            const timeAmPmEl = contentElement.querySelector('#time-ampm');
            const dateDisplay = contentElement.querySelector('#date-display');
            const updateClock = () => {
                const now = new Date();
                let hours = now.getHours();
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12; // the hour '0' should be '12'
                timeValueEl.textContent = `${hours}:${minutes}`;
                timeAmPmEl.textContent = ampm;
            };
            dateDisplay.textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            updateClock();
            clockInterval = setInterval(updateClock, 1000);
        }
        
        // --- PERSISTENT MUSIC PLAYER LOGIC ---
        const loadTrack = (index) => {
            const track = tracks[index];
            audioPlayer.src = track.url;
            currentTrackIndex = index;
            if(activeTab === 'music') {
                const content = contentContainer.querySelector('.music-player');
                if(content) {
                    content.querySelector('#track-title').textContent = track.title;
                    content.querySelector('#track-artist').textContent = track.artist;
                    const allItems = content.querySelectorAll('#track-list-ul li');
                    allItems.forEach((item, i) => {
                        const shouldBeActive = i === index;
                        if (shouldBeActive && !item.classList.contains('active')) {
                            item.classList.add('flash');
                            item.addEventListener('animationend', () => item.classList.remove('flash'), { once: true });
                        }
                        item.classList.toggle('active', shouldBeActive);
                    });
                }
            }
        };
        const playTrack = () => { audioPlayer.play(); };
        const pauseTrack = () => { audioPlayer.pause(); };
        const togglePlayPause = () => { playSound('note'); isPlaying ? pauseTrack() : playTrack(); };
        const changeTrack = (direction) => {
            playSound('note');
            const newIndex = (currentTrackIndex + direction + tracks.length) % tracks.length;
            loadTrack(newIndex);
            if(isPlaying) playTrack();
        };
        function initMusicPlayerUI(contentElement) {
            const playPauseBtn = contentElement.querySelector('#play-pause-btn');
            const trackListUl = contentElement.querySelector('#track-list-ul');

            contentElement.querySelector('#track-title').textContent = tracks[currentTrackIndex].title;
            contentElement.querySelector('#track-artist').textContent = tracks[currentTrackIndex].artist;
            playPauseBtn.innerHTML = isPlaying ? pauseIcon : playIcon;

            const updateProgress = () => {
                const { duration, currentTime } = audioPlayer;
                const progressBar = contentElement.querySelector('#progress-bar');
                if(progressBar) progressBar.style.width = duration ? `${(currentTime / duration) * 100}%` : '0%';
            };
            updateProgress();

            playPauseBtn.addEventListener('click', togglePlayPause);
            contentElement.querySelector('#next-btn').addEventListener('click', () => changeTrack(1));
            contentElement.querySelector('#prev-btn').addEventListener('click', () => changeTrack(-1));
            contentElement.querySelector('#progress-container').addEventListener('click', (e) => {
                const { duration } = audioPlayer;
                if(duration) { audioPlayer.currentTime = (e.offsetX / e.currentTarget.clientWidth) * duration; }
            });
            
            trackListUl.innerHTML = '';
            tracks.forEach((track, index) => {
                const li = document.createElement('li');
                li.dataset.index = index;
                li.setAttribute('role', 'button');
                li.setAttribute('tabindex', '0');
                li.innerHTML = `<p class="title">${track.title}</p><p class="artist">${track.artist}</p>`;
                li.classList.toggle('active', index === currentTrackIndex);
                trackListUl.appendChild(li);
            });

            const handleTrackSelection = (index) => {
                if(currentTrackIndex === index) { togglePlayPause(); return; }
                playSound('note');
                loadTrack(index);
                playTrack();
            };
            trackListUl.addEventListener('click', (e) => {
                const targetLi = e.target.closest('li');
                if(targetLi) handleTrackSelection(parseInt(targetLi.dataset.index));
            });
            trackListUl.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const targetLi = e.target.closest('li');
                    if(targetLi) handleTrackSelection(parseInt(targetLi.dataset.index));
                }
            });
        }

        // --- INITIALIZATION ---
        const init = () => {
            const shapeSVGs = [`<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`, `<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`, `<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/></svg>`];
            for (let i = 0; i < 14; i++) {
                const shape = document.createElement('div');
                shape.classList.add('shape');
                shape.innerHTML = shapeSVGs[i % shapeSVGs.length];
                const size = Math.random() * 25 + 20;
                shape.style.width = `${size}px`; shape.style.height = `${size}px`;
                shape.style.left = `${Math.random() * 100}vw`;
                shape.style.animationDuration = `${Math.random() * 20 + 20}s`;
                shape.style.animationDelay = `${Math.random() * 15}s`;
                floatingShapesContainer.appendChild(shape);
            }

            dock.addEventListener('click', (e) => {
                const targetButton = e.target.closest('.dock-item');
                if (targetButton) {
                    playSound('click');
                    switchTab(targetButton.dataset.tab);
                }
            });

            dock.addEventListener('mouseover', (e) => {
                const targetButton = e.target.closest('.dock-item');
                if (targetButton) playSound('hover');
            });

            audioPlayer.addEventListener('play', () => { isPlaying = true; if(activeTab === 'music') { const btn = contentContainer.querySelector('#play-pause-btn'); if(btn) btn.innerHTML = pauseIcon; }});
            audioPlayer.addEventListener('pause', () => { isPlaying = false; if(activeTab === 'music') { const btn = contentContainer.querySelector('#play-pause-btn'); if(btn) btn.innerHTML = pauseIcon; }});
            audioPlayer.addEventListener('timeupdate', () => { if(activeTab === 'music') { const { duration, currentTime } = audioPlayer; const progressBar = contentContainer.querySelector('#progress-bar'); if (progressBar) progressBar.style.width = duration ? `${(currentTime / duration) * 100}%` : '0%'; }});
            audioPlayer.addEventListener('ended', () => changeTrack(1));

            loadTrack(currentTrackIndex);
            switchTab('home');
            
            const firstInteractionHandler = () => { initAudioContext(); if (audioContext && audioContext.state === 'suspended') audioContext.resume(); };
            window.addEventListener('click', firstInteractionHandler, { once: true });
            window.addEventListener('touchend', firstInteractionHandler, { once: true });
        };
        
        init();
      });
    </script>
</body>
</html>
