<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>♪ Pola's Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
      :root {
        --font-title: 'Fredoka One', 'cursive';
        --font-body: 'Nunito', 'sans-serif';
        --color-accent: #EC4899; /* fuchsia-500 */
        --color-accent-dark: #f472b6; /* pink-400 */
        --color-text-primary: #1e293b; /* slate-800 */
        --color-text-secondary: #475569; /* slate-600 */
        --color-bg-light: #FFFFFF;
        --color-bg-window: rgba(255, 255, 255, 0.8);
      }

      /* Base and Reset */
      html, body {
        height: 100%;
        width: 100%;
        overflow: hidden;
        overscroll-behavior: none;
        margin: 0;
        padding: 0;
        font-family: var(--font-body);
        -webkit-tap-highlight-color: transparent;
      }

      /* Main Layout */
      .app-container {
        height: 100vh;
        width: 100vw;
        overflow: hidden;
        background: linear-gradient(135deg, #e0e7ff, #fecdd3, #fef3c7);
        background-size: 200% 200%;
        animation: background-pan 15s ease infinite;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        padding: 16px;
        box-sizing: border-box;
      }
      
      .main-content-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        z-index: 10;
        width: 100%;
        max-width: 384px;
        opacity: 0;
        transform: translateY(30px);
        animation: fade-in-up 0.8s 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      }

      /* Floating Shapes (Performance Optimized) */
      .floating-shapes {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 0;
      }
      .shape {
        position: absolute;
        bottom: -150px;
        color: rgba(255, 255, 255, 0.2);
        animation: float linear infinite;
        contain: strict; /* Huge performance boost for animations */
      }

      /* Content Window (Performance Optimized) */
      .content-window-container {
        width: 100%;
        height: clamp(400px, 65vh, 450px);
        position: relative;
      }
      .content-window {
        width: 100%;
        height: 100%;
        border-radius: 1rem;
        border: 2px solid var(--color-text-primary);
        background-color: var(--color-bg-window);
        padding: 20px;
        box-shadow: 8px 8px 0px var(--color-text-primary);
        backdrop-filter: blur(8px);
        box-sizing: border-box;
        position: absolute;
        will-change: transform, opacity; /* Performance boost for animations */
      }
      .content-window.entering { animation: pop-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
      .content-window.exiting { animation: shrink-out 0.3s cubic-bezier(0.55, 0.06, 0.68, 0.19) forwards; }

      /* Dock Navigation */
      .dock {
        position: relative;
        display: flex;
        width: fit-content;
        align-items: center;
        justify-content: center;
        gap: 8px;
        border-radius: 9999px;
        border: 2px solid var(--color-text-primary);
        background-color: var(--color-bg-window);
        padding: 8px;
        box-shadow: 6px 6px 0px var(--color-text-primary);
        backdrop-filter: blur(8px);
      }
      .dock-item {
        position: relative;
        display: flex;
        width: 48px; height: 48px;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease-in-out;
        color: var(--color-text-primary);
        opacity: 0.6;
        background: none; border: none; cursor: pointer;
      }
      .dock-item:hover {
        opacity: 1;
        transform: scale(1.2);
      }
      .dock-item.active {
        color: var(--color-bg-light);
        opacity: 1;
      }
      .dock-item svg { width: 28px; height: 28px; }
      .active-pill {
        position: absolute;
        top: 8px; left: 8px;
        height: 48px; width: 48px;
        border-radius: 50%;
        background-image: linear-gradient(to top, var(--color-accent), var(--color-accent-dark));
        box-shadow: 0px 4px 12px -2px var(--color-accent);
        transition: transform 0.6s cubic-bezier(0.68, -0.6, 0.32, 1.6);
        z-index: -1;
      }

      /* Home Window (Refined Spacing) */
      .home-content { display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: var(--color-text-primary); height: 100%; box-sizing: border-box; gap: 12px; }
      .home-content img { width: 112px; height: 112px; border-radius: 50%; border: 4px solid var(--color-text-primary); object-fit: cover; cursor: pointer; transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }
      .home-content img:hover { transform: scale(1.1) rotate(-6deg); border-color: var(--color-accent); box-shadow: 5px 5px 0px var(--color-accent-dark); }
      .home-content h1 { font-family: var(--font-title); font-size: 2.25rem; margin: 0; }
      .home-content .quote { max-width: 320px; font-size: 0.75rem; line-height: 1.5; color: var(--color-text-secondary); margin: 0; }
      .home-content .status { display: flex; align-items: center; gap: 8px; font-size: 1.125rem; font-weight: 700; margin: 0; }
      .home-content .status span { color: var(--color-accent); animation: heart-thump 1.2s ease-in-out infinite; }
      .home-content .socials { display: flex; gap: 20px; margin-top: 8px; }
      .home-content .socials a { color: var(--color-text-secondary); transition: all 0.3s; }
      .home-content .socials a:hover { color: var(--color-accent); animation: jiggle 0.5s; }
      .home-content .socials svg { width: 28px; height: 28px; }
      
      /* Gallery Window */
      .gallery-content { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; height: 100%; }
      .gallery-item { position: relative; cursor: pointer; overflow: hidden; border-radius: 0.75rem; border: 2px solid var(--color-text-primary); transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
      .gallery-item:hover { transform: translateY(-8px) scale(1.05) rotate(3deg); border-color: var(--color-accent); box-shadow: 8px 8px 0px var(--color-accent-dark); }
      .gallery-item img { display: block; width: 100%; height: 100%; object-fit: cover; }
      .gallery-item::after { content: ''; position: absolute; top: -50%; left: -60%; width: 20%; height: 200%; background: linear-gradient(to right, transparent, rgba(255,255,255,0.4), transparent); transform: rotate(25deg); transition: left 0.8s cubic-bezier(0.23, 1, 0.32, 1); }
      .gallery-item:hover::after { left: 140%; }
      
      /* Clock Window */
      .clock-content { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--color-text-primary); }
      .clock-content .time-display { font-family: var(--font-title); font-size: clamp(3rem, 18vw, 5rem); line-height: 1; letter-spacing: 0.05em; display: flex; align-items: baseline; }
      .clock-content .time-ampm { font-size: 1.25rem; margin-left: 8px; opacity: 0.6; font-family: var(--font-body); font-weight: 700; color: var(--color-text-secondary); }
      .clock-content .date-display { margin-top: 8px; text-align: center; font-size: 0.875rem; font-weight: 700; color: var(--color-text-secondary); }

      /* Music Player (Rebuilt with CSS Grid) */
      .music-player {
        display: grid;
        grid-template-rows: auto auto auto 1fr; /* Info, Progress, Controls, Tracklist */
        gap: 16px; /* Consistent vertical spacing */
        height: 100%;
        color: var(--color-text-primary);
      }
      .music-player .track-info { text-align: center; }
      .music-player .track-info h2 { font-family: var(--font-title); font-size: 1.25rem; font-weight: 900; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin: 0 0 4px; }
      .music-player .track-info p { margin: 0; font-size: 0.875rem; color: var(--color-text-secondary); }
      .music-player .progress-bar-container { width: 100%; height: 10px; background-color: rgba(30, 41, 59, 0.1); border-radius: 9999px; cursor: pointer; }
      .music-player .progress-bar { height: 100%; background-color: var(--color-accent); border-radius: 9999px; }
      .music-player .controls { display: flex; align-items: center; justify-content: center; gap: 20px; }
      .music-player .control-btn { border-radius: 50%; border: 3px solid var(--color-text-primary); background: var(--color-bg-light); color: var(--color-text-primary); cursor: pointer; transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); display:flex; justify-content:center; align-items:center; }
      .music-player .control-btn:hover { transform: scale(1.1) translateY(-2px); color: var(--color-accent); border-color: var(--color-accent); }
      .music-player .control-btn:active { transform: scale(0.95); transition-duration: 0.1s; }
      .music-player .play-pause-btn { width: 72px; height: 72px; color: var(--color-bg-light); background-color: var(--color-text-primary); box-shadow: 4px 4px 0px var(--color-accent-dark); }
      .music-player .play-pause-btn .icon-position { transform: translateX(2px); }
      .music-player .prev-next-btn { width: 52px; height: 52px; }
      .music-player .tracklist { overflow-y: auto; padding-right: 8px; min-height: 0; } /* min-height fixes grid overflow */
      .music-player .tracklist ul { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px; }
      .music-player .tracklist li { cursor: pointer; border-radius: 0.5rem; border: 2px solid transparent; padding: 8px; transition: all 0.2s; }
      .music-player .tracklist li:hover { background-color: rgba(236, 72, 153, 0.5); }
      .music-player .tracklist li.active { border-color: var(--color-text-primary); background-color: var(--color-accent); color: var(--color-text-primary); animation: flash-in 0.4s ease; }
      .music-player .tracklist li.active .title { font-weight: 900; }
      .music-player .tracklist .title { font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .music-player .tracklist .artist { font-size: 0.75rem; color: var(--color-text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      
      /* Utilities & Helpers */
      .gradient-text { background: linear-gradient(to right, #d946ef, #ec4899); -webkit-background-clip: text; background-clip: text; color: transparent; }
      .scrollbar-custom::-webkit-scrollbar { width: 8px; }
      .scrollbar-custom::-webkit-scrollbar-track { background: transparent; }
      .scrollbar-custom::-webkit-scrollbar-thumb { background-color: var(--color-accent); border-radius: 10px; border: 2px solid var(--color-bg-light); }
      :is(button, a, .gallery-item, .tracklist li):focus-visible { outline: 3px solid var(--color-accent); outline-offset: 3px; border-radius: 8px; box-shadow: 0 0 0 4px var(--color-bg-window); }

      /* Keyframes */
      @keyframes background-pan { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
      @keyframes float { from { transform: translateY(0px) rotate(0deg); opacity: 1; } to { transform: translateY(-110vh) rotate(360deg); opacity: 0; } }
      @keyframes heart-thump { 0%, 100% { transform: scale(1); } 10%, 30% { transform: scale(0.9); } 20% { transform: scale(1.2); } }
      @keyframes pop-in { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
      @keyframes shrink-out { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.5); } }
      @keyframes fade-in-up { to { opacity: 1; transform: translateY(0); } }
      @keyframes flash-in { 0% { transform: scale(0.95); opacity: 0.7; } 50% { transform: scale(1.05); } 100% { transform: scale(1); opacity: 1; } }
      @keyframes jiggle { 0%, 100% { transform: rotate(0) scale(1.1); } 25% { transform: rotate(-5deg) scale(1.1); } 50% { transform: rotate(5deg) scale(1.1); } 75% { transform: rotate(-2deg) scale(1.1); } }

      /* Responsive */
      @media (max-width: 380px) {
        .dock { gap: 4px; padding: 6px; }
        .dock-item { width: 44px; height: 44px; }
        .active-pill { top: 6px; left: 6px; width: 44px; height: 44px; }
        .dock-item svg { width: 24px; height: 24px; }
        .music-player .play-pause-btn { width: 64px; height: 64px; }
        .music-player .prev-next-btn { width: 48px; height: 48px; }
      }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <div class="floating-shapes"></div>

        <main class="main-content-wrapper">
            <div id="content-window-container" class="content-window-container"></div>
            <nav id="dock" class="dock">
                <div id="active-pill" class="active-pill"></div>
                <button class="dock-item" data-tab="home" aria-label="home">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></svg>
                </button>
                <button class="dock-item" data-tab="music" aria-label="music">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13" /><circle cx="6" cy="18" r="3" /><circle cx="18" cy="16" r="3" /></svg>
                </button>
                <button class="dock-item" data-tab="gallery" aria-label="gallery">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2" /><circle cx="9" cy="9" r="2" /><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" /></svg>
                </button>
                <button class="dock-item" data-tab="clock" aria-label="clock">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></svg>
                </button>
            </nav>
        </main>
        <audio id="audio-player" style="display:none;"></audio>
    </div>

    <!-- TEMPLATES -->
    <template id="home-template">
        <div class="home-content">
            <img src="https://i.ibb.co/dPFpGv9/Default-Cute-anime-boy-pray-3d-art-cartoon-blue-1-30826f36-54b1-49e4-b141-5caad93c4a2c-0.jpg" alt="Profile" />
            <h1><span class="gradient-text">♪ Pola</span></h1>
            <p class="quote">"But those who hope in the LORD will renew their strength. They will soar on wings like eagles; they will run and not grow weary, they will walk and not be faint." (Isaiah 40:31)</p>
            <p class="status"><span>❤</span> GOD IS LOVE <span>❤</span></p>
            <div class="socials">
                <a href="https://github.com/bolae700" target="_blank" rel="noopener noreferrer" aria-label="Github Profile"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
                <a href="https://www.youtube.com/@SoundSurge3" target="_blank" rel="noopener noreferrer" aria-label="YouTube Channel"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 17a24.12 24.12 0 0 1 0-10C2.5 6 7.5 4 12 4s9.5 2 9.5 3a24.12 24.12 0 0 1 0 10c0 1-5 3-9.5 3s-9.5-2-9.5-3Z"></path><path d="m10 15 5-3-5-3z"></path></svg></a>
            </div>
        </div>
    </template>
    <template id="gallery-template">
        <div class="gallery-content">
            <div class="gallery-item" tabindex="0"><img src="https://i.ibb.co/pXfwCcv/2d79b46de2deb3744fd330d815b76751.jpg" alt="gallery image 1" loading="lazy" /></div>
            <div class="gallery-item" tabindex="0"><img src="https://i.ibb.co/Jyq80hX/bfa64e7da2612eb344663aa3fbcf2f59.png" alt="gallery image 2" loading="lazy" /></div>
            <div class="gallery-item" tabindex="0"><img src="https://i.ibb.co/dDVSRPD/ss.png" alt="gallery image 3" loading="lazy" /></div>
            <div class="gallery-item" tabindex="0"><img src="https://xatimg.com/image/rWDHtSw2pqG2.jpg" alt="gallery image 4" loading="lazy" /></div>
        </div>
    </template>
    <template id="clock-template">
        <div class="clock-content">
            <div class="time-display gradient-text">
                <span id="time-value"></span><span id="time-ampm" class="time-ampm"></span>
            </div>
            <div id="date-display" class="date-display"></div>
        </div>
    </template>
    <template id="music-template">
        <div class="music-player">
            <div class="track-info">
                <h2 id="track-title"></h2>
                <p id="track-artist"></p>
            </div>
            <div id="progress-container" class="progress-bar-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
            <div class="controls">
                <button id="prev-btn" class="control-btn prev-next-btn" aria-label="Previous Song"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 19 2 12 11 5 11 19"></polygon><polygon points="22 19 13 12 22 5 22 19"></polygon></svg></button>
                <button id="play-pause-btn" class="control-btn play-pause-btn" aria-label="Play"></button>
                <button id="next-btn" class="control-btn prev-next-btn" aria-label="Next Song"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 19 22 12 13 5 13 19"></polygon><polygon points="2 19 11 12 2 5 19"></polygon></svg></button>
            </div>
            <div class="tracklist scrollbar-custom">
                <ul id="track-list-ul"></ul>
            </div>
        </div>
    </template>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // --- CONFIG & CONSTANTS ---
        const TRACKS = [
            { url: "https://audio.jukehost.co.uk/QyPglgdEHAkfqpR1NH5rMHiewfPCSg4o", title: "Ahlef be allah", artist: "Haitham Shaker" },
            { url: "https://audio.jukehost.co.uk/GkbwKXyHWfNGWHtJWsdemKmpOFJFkdCK", title: "Alors on dance", artist: "Stromae" },
            { url: "https://audio.jukehost.co.uk/MHf54iEPyQIkSmY55VYlqHGSH7CVQqdA", title: "Casablanca", artist: "Emre Kabak" },
            { url: "https://audio.jukehost.co.uk/GOzONzgMkJgOFZgbzmCAPU3uXpKKcYAh", title: "Unstoppable", artist: "Sia" },
            { url: "https://audio.jukehost.co.uk/c77yqDnvZV6lAmIPQPanmSgqVpnlnDyv", title: "Saber W Radi", artist: "George Wassouf" },
            { url: "https://audio.jukehost.co.uk/6tOF41jBlb83ocuYrxtuW7sAmEgyRyFZ", title: "Shoukran", artist: "George Wassouf" },
            { url: "https://audio.jukehost.co.uk/bbabQwnKnYhXlaRD8alUDCzGEhyu9Rwm", title: "Khadny 7aneen", artist: "George Wassouf" },
            { url: "https://audio.jukehost.co.uk/lrUXO0jmrJRZANKo0Gx9XEQ0PFuQxKN5", title: "Yalli Bitghib Aleiya", artist: "Haitham Shaker" },
            { url: "https://audio.jukehost.co.uk/6IQhCPy39Jv5Uxj9WI4fFMeUuJMWWR2D", title: "Khalik Ganbi", artist: "Haitham Shaker" },
        ];
        const playIcon = `<div class="icon-position"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></div>`;
        const pauseIcon = `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>`;

        // --- STATE ---
        let activeTab = 'home';
        let animationState = 'entering';
        let clockInterval = null;
        let audioContext = null;

        // --- DOM ELEMENTS ---
        const contentContainer = document.getElementById('content-window-container');
        const dock = document.getElementById('dock');
        const dockItems = document.querySelectorAll('.dock-item');
        const activePill = document.getElementById('active-pill');
        const floatingShapesContainer = document.querySelector('.floating-shapes');
        const audioPlayer = document.getElementById('audio-player');

        // --- SOUND SERVICE ---
        const soundService = {
            init() {
                if (audioContext) return;
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    if (audioContext.state === 'suspended') audioContext.resume();
                } catch (e) {
                    console.warn("Web Audio API is not supported.");
                }
            },
            play(type) {
                if (!audioContext || audioContext.state === 'suspended') return;
                const o = audioContext.createOscillator();
                const g = audioContext.createGain();
                o.connect(g);
                g.connect(audioContext.destination);
                const now = audioContext.currentTime;
                if (type === 'click') { o.type = 'triangle'; g.gain.setValueAtTime(0.3, now); o.frequency.setValueAtTime(440, now); g.gain.exponentialRampToValueAtTime(0.001, now + 0.1); o.frequency.exponentialRampToValueAtTime(220, now + 0.1); }
                else if (type === 'hover') { o.type = 'sine'; g.gain.setValueAtTime(0.05, now); o.frequency.setValueAtTime(800, now); g.gain.exponentialRampToValueAtTime(0.001, now + 0.1); }
                else if (type === 'note') { o.type = 'sine'; g.gain.setValueAtTime(0.2, now); o.frequency.setValueAtTime(392, now); g.gain.exponentialRampToValueAtTime(0.001, now + 0.15); }
                o.start(now);
                o.stop(now + 0.2);
            }
        };

        // --- MUSIC PLAYER ---
        const musicPlayerState = {
            currentTrackIndex: 0,
            isPlaying: false,
        };
        const musicPlayerElements = {}; // Cached DOM elements for performance
        
        function updateMusicUI() {
            if (activeTab !== 'music' || !musicPlayerElements.container) return;

            const track = TRACKS[musicPlayerState.currentTrackIndex];
            musicPlayerElements.title.textContent = track.title;
            musicPlayerElements.artist.textContent = track.artist;
            musicPlayerElements.playPauseBtn.innerHTML = musicPlayerState.isPlaying ? pauseIcon : playIcon;

            const { duration, currentTime } = audioPlayer;
            const progress = duration ? (currentTime / duration) * 100 : 0;
            musicPlayerElements.progressBar.style.width = `${progress}%`;

            musicPlayerElements.trackListItems.forEach((item, index) => {
                item.classList.toggle('active', index === musicPlayerState.currentTrackIndex);
            });
        }

        function loadTrack(index) {
            musicPlayerState.currentTrackIndex = index;
            audioPlayer.src = TRACKS[index].url;
            audioPlayer.load();
            if (musicPlayerState.isPlaying) {
                audioPlayer.play().catch(e => console.error("Autoplay failed", e));
            }
            updateMusicUI();
        }

        function togglePlayPause() {
            soundService.play('note');
            musicPlayerState.isPlaying = !musicPlayerState.isPlaying;
            if (musicPlayerState.isPlaying) {
                audioPlayer.play().catch(e => console.error("Play failed", e));
            } else {
                audioPlayer.pause();
            }
        }
        
        function changeTrack(direction) {
            soundService.play('note');
            const newIndex = (musicPlayerState.currentTrackIndex + direction + TRACKS.length) % TRACKS.length;
            loadTrack(newIndex);
        }

        function selectTrack(index) {
            if (index === musicPlayerState.currentTrackIndex) {
                togglePlayPause();
            } else {
                soundService.play('note');
                musicPlayerState.isPlaying = true;
                loadTrack(index);
            }
        }
        
        audioPlayer.addEventListener('play', () => { musicPlayerState.isPlaying = true; updateMusicUI(); });
        audioPlayer.addEventListener('pause', () => { musicPlayerState.isPlaying = false; updateMusicUI(); });
        audioPlayer.addEventListener('ended', () => changeTrack(1));
        audioPlayer.addEventListener('timeupdate', updateMusicUI);

        // --- UI & TABS ---
        function updatePillPosition(activeButton) {
            const firstItemOffset = dock.querySelector('.dock-item').offsetLeft;
            const offset = activeButton.offsetLeft - firstItemOffset;
            activePill.style.transform = `translateX(${offset}px)`;
        }

        function switchTab(tabId) {
            if (activeTab === tabId || animationState === 'exiting') return;
            soundService.play('click');
            
            if (clockInterval) { clearInterval(clockInterval); clockInterval = null; }
            activeTab = tabId;
            animationState = 'exiting';

            const oldContent = contentContainer.querySelector('.content-window');
            if (oldContent) {
                oldContent.classList.remove('entering');
                oldContent.classList.add('exiting');
                oldContent.addEventListener('animationend', () => oldContent.remove(), { once: true });
            }

            setTimeout(() => {
                const template = document.getElementById(`${tabId}-template`);
                const newContent = document.createElement('div');
                newContent.classList.add('content-window', 'entering');
                newContent.innerHTML = template.innerHTML;
                contentContainer.appendChild(newContent);
                animationState = 'entering';
                
                if (tabId === 'clock') initClock(newContent);
                if (tabId === 'music') initMusicPlayerUI(newContent);
            }, oldContent ? 150 : 0);

            dockItems.forEach(item => item.classList.toggle('active', item.dataset.tab === tabId));
            updatePillPosition(dock.querySelector(`[data-tab="${tabId}"]`));
        }

        // --- TAB-SPECIFIC INITIALIZERS ---
        function initClock(content) {
            const timeValueEl = content.querySelector('#time-value');
            const timeAmPmEl = content.querySelector('#time-ampm');
            const dateDisplayEl = content.querySelector('#date-display');
            
            function update() {
                const now = new Date();
                let hours = now.getHours();
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12 || 12;
                timeValueEl.textContent = `${hours}:${minutes}`;
                timeAmPmEl.textContent = ampm;
            }
            dateDisplayEl.textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            update();
            clockInterval = setInterval(update, 1000);
        }

        function initMusicPlayerUI(content) {
            // Cache elements for performance
            musicPlayerElements.container = content;
            musicPlayerElements.title = content.querySelector('#track-title');
            musicPlayerElements.artist = content.querySelector('#track-artist');
            musicPlayerElements.progressBar = content.querySelector('#progress-bar');
            musicPlayerElements.playPauseBtn = content.querySelector('#play-pause-btn');
            musicPlayerElements.trackListItems = [];
            
            const trackListUl = content.querySelector('#track-list-ul');
            trackListUl.innerHTML = '';
            TRACKS.forEach((track, index) => {
                const li = document.createElement('li');
                li.setAttribute('role', 'button');
                li.setAttribute('tabindex', '0');
                li.innerHTML = `<p class="title">${track.title}</p><p class="artist">${track.artist}</p>`;
                li.addEventListener('click', () => selectTrack(index));
                li.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') selectTrack(index); });
                trackListUl.appendChild(li);
                musicPlayerElements.trackListItems.push(li);
            });
            content.querySelector('#prev-btn').addEventListener('click', () => changeTrack(-1));
            content.querySelector('#next-btn').addEventListener('click', () => changeTrack(1));
            content.querySelector('#play-pause-btn').addEventListener('click', togglePlayPause);
            content.querySelector('#progress-container').addEventListener('click', (e) => {
                const { duration } = audioPlayer;
                if(duration) { audioPlayer.currentTime = (e.offsetX / e.currentTarget.clientWidth) * duration; }
            });
            updateMusicUI();
        }

        // --- INITIALIZATION ---
        function init() {
            // Floating shapes
            const shapeSVGs = [`<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`, `<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`, `<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/></svg>`];
            for (let i = 0; i < 10; i++) {
                const shape = document.createElement('div');
                shape.className = 'shape';
                shape.innerHTML = shapeSVGs[i % 3];
                const size = Math.random() * 25 + 20;
                shape.style.cssText = `width:${size}px; height:${size}px; left:${Math.random()*100}vw; animation-duration:${Math.random()*20+20}s; animation-delay:${Math.random()*15}s;`;
                floatingShapesContainer.appendChild(shape);
            }
            
            // Dock events
            dock.addEventListener('click', (e) => {
                const targetButton = e.target.closest('.dock-item');
                if (targetButton) switchTab(targetButton.dataset.tab);
            });
            dock.addEventListener('mouseover', (e) => {
                if (e.target.closest('.dock-item')) soundService.play('hover');
            });

            // First interaction
            const firstInteractionHandler = () => { 
                soundService.init();
                loadTrack(0);
                window.removeEventListener('click', firstInteractionHandler);
                window.removeEventListener('touchend', firstInteractionHandler);
            };
            window.addEventListener('click', firstInteractionHandler, { once: true });
            window.addEventListener('touchend', firstInteractionHandler, { once: true });

            switchTab('home');
        }
        
        init();
      });
    </script>
</body>
</html>
